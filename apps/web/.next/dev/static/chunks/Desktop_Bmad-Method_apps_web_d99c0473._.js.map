{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/jdc/Desktop/Bmad-Method/apps/web/components/ui/Card.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { PropsWithChildren } from 'react';\r\n\r\ntype CardProps = PropsWithChildren<{\r\n  title?: string;\r\n  description?: string;\r\n  accent?: 'success' | 'warning' | 'critical' | 'info';\r\n}>;\r\n\r\nconst accentStyles: Record<NonNullable<CardProps['accent']>, string> = {\r\n  success: 'var(--color-success)',\r\n  warning: 'var(--color-calm-gold)',\r\n  critical: 'var(--color-coral)',\r\n  info: 'var(--color-soft-aqua)'\r\n};\r\n\r\nexport function Card({ title, description, accent, children }: CardProps) {\r\n  return (\r\n    <article className=\"card\" data-accent={accent ?? 'none'}>\r\n      {(title || description) && (\r\n        <header>\r\n          {title && <h3>{title}</h3>}\r\n          {description && <p className=\"card-description\">{description}</p>}\r\n        </header>\r\n      )}\r\n      <div>{children}</div>\r\n      <style jsx>{`\r\n        .card {\r\n          position: relative;\r\n          background: var(--color-neutral-0);\r\n          border-radius: var(--radius-md);\r\n          padding: var(--space-5);\r\n          box-shadow: var(--shadow-card);\r\n          border: 1px solid var(--app-border-subtle);\r\n          display: grid;\r\n          gap: var(--space-5);\r\n        }\r\n        .card::before {\r\n          content: '';\r\n          position: absolute;\r\n          inset: 0;\r\n          border-radius: calc(var(--radius-md) - 1px);\r\n          border: 1px solid transparent;\r\n          pointer-events: none;\r\n        }\r\n        .card[data-accent='success']::before {\r\n          border-top-color: ${accentStyles.success};\r\n        }\r\n        .card[data-accent='warning']::before {\r\n          border-top-color: ${accentStyles.warning};\r\n        }\r\n        .card[data-accent='critical']::before {\r\n          border-top-color: ${accentStyles.critical};\r\n        }\r\n        .card[data-accent='info']::before {\r\n          border-top-color: ${accentStyles.info};\r\n        }\r\n        header h3 {\r\n          margin: 0;\r\n          font-size: 1.125rem;\r\n          color: var(--color-neutral-3);\r\n          letter-spacing: -0.01em;\r\n        }\r\n        .card-description {\r\n          margin: var(--space-2) 0 0;\r\n          color: var(--color-neutral-2);\r\n          line-height: 1.5;\r\n        }\r\n        @media (max-width: 768px) {\r\n          .card {\r\n            padding: var(--space-4);\r\n          }\r\n        }\r\n      `}</style>\r\n    </article>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;;;AAUA,MAAM,eAAiE;IACrE,SAAS;IACT,SAAS;IACT,UAAU;IACV,MAAM;AACR;AAEO,SAAS,KAAK,EAAE,KAAK,EAAE,WAAW,EAAE,MAAM,EAAE,QAAQ,EAAa;IACtE,qBACE,0NAAC;QAAyB,eAAa,UAAU;iDAA9B;;YAChB,CAAC,SAAS,WAAW,mBACpB,0NAAC;;;oBACE,uBAAS,0NAAC;;kCAAI;;;;;;oBACd,6BAAe,0NAAC;iEAAY;kCAAoB;;;;;;;;;;;;0BAGrD,0NAAC;;0BAAK;;;;;;;;4eAqBkB,aAAa,OAAO,2EAGpB,aAAa,OAAO,4EAGpB,aAAa,QAAQ,wEAGrB,aAAa,IAAI;;;;;;;;AAqB/C;KA5DgB","debugId":null}},
    {"offset": {"line": 78, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/jdc/Desktop/Bmad-Method/apps/web/services/api/auth.ts"],"sourcesContent":["import { CoreApiError } from './housekeeping';\r\n\r\nconst CORE_API_BASE_URL =\r\n  process.env.NEXT_PUBLIC_CORE_API_BASE_URL ?? 'http://localhost:8000';\r\n\r\ninterface LoginDto {\r\n  session_id: string;\r\n  agent_id: number;\r\n  mfa_required: boolean;\r\n  expires_at: string;\r\n  session_timeout_seconds: number;\r\n  recovery_codes_remaining: number;\r\n}\r\n\r\ninterface RecoveryInitiateDto {\r\n  email: string;\r\n  issued_at: string;\r\n  recovery_codes: string[];\r\n}\r\n\r\nexport interface LoginPayload {\r\n  email: string;\r\n  password: string;\r\n}\r\n\r\nexport interface LoginResult {\r\n  sessionId: string;\r\n  agentId: number;\r\n  mfaRequired: boolean;\r\n  expiresAt: string;\r\n  sessionTimeoutSeconds: number;\r\n  recoveryCodesRemaining: number;\r\n}\r\n\r\nexport interface MfaVerificationPayload {\r\n  sessionId: string;\r\n  code: string;\r\n  method?: 'totp' | 'recovery';\r\n}\r\n\r\nexport interface RecoveryInitiation {\r\n  email: string;\r\n  issuedAt: string;\r\n  recoveryCodes: string[];\r\n}\r\n\r\nexport interface RecoveryCompletionPayload {\r\n  email: string;\r\n  code: string;\r\n}\r\n\r\nexport async function login(payload: LoginPayload): Promise<LoginResult> {\r\n  const url = new URL('/auth/login', CORE_API_BASE_URL);\r\n  const response = await fetch(url, {\r\n    method: 'POST',\r\n    headers: {\r\n      Accept: 'application/json',\r\n      'Content-Type': 'application/json'\r\n    },\r\n    body: JSON.stringify(payload)\r\n  });\r\n\r\n  if (!response.ok) {\r\n    const body = await safeReadJson(response);\r\n    throw new CoreApiError('Failed to authenticate', response.status, body);\r\n  }\r\n\r\n  const dto = (await response.json()) as LoginDto;\r\n  return mapLogin(dto);\r\n}\r\n\r\nexport async function verifyMfa(payload: MfaVerificationPayload): Promise<LoginResult> {\r\n  const url = new URL('/auth/mfa/verify', CORE_API_BASE_URL);\r\n  const response = await fetch(url, {\r\n    method: 'POST',\r\n    headers: {\r\n      Accept: 'application/json',\r\n      'Content-Type': 'application/json'\r\n    },\r\n    body: JSON.stringify({\r\n      session_id: payload.sessionId,\r\n      code: payload.code,\r\n      method: payload.method ?? 'totp'\r\n    })\r\n  });\r\n\r\n  if (!response.ok) {\r\n    const body = await safeReadJson(response);\r\n    throw new CoreApiError('Failed to verify MFA', response.status, body);\r\n  }\r\n\r\n  const dto = (await response.json()) as LoginDto;\r\n  return mapLogin(dto);\r\n}\r\n\r\nexport async function initiateRecovery(email: string): Promise<RecoveryInitiation> {\r\n  const url = new URL('/auth/recovery/initiate', CORE_API_BASE_URL);\r\n  const response = await fetch(url, {\r\n    method: 'POST',\r\n    headers: {\r\n      Accept: 'application/json',\r\n      'Content-Type': 'application/json'\r\n    },\r\n    body: JSON.stringify({ email })\r\n  });\r\n\r\n  if (!response.ok) {\r\n    const body = await safeReadJson(response);\r\n    throw new CoreApiError('Failed to initiate recovery', response.status, body);\r\n  }\r\n\r\n  const dto = (await response.json()) as RecoveryInitiateDto;\r\n  return {\r\n    email: dto.email,\r\n    issuedAt: dto.issued_at,\r\n    recoveryCodes: dto.recovery_codes\r\n  };\r\n}\r\n\r\nexport async function completeRecovery(\r\n  payload: RecoveryCompletionPayload\r\n): Promise<LoginResult> {\r\n  const url = new URL('/auth/recovery/complete', CORE_API_BASE_URL);\r\n  const response = await fetch(url, {\r\n    method: 'POST',\r\n    headers: {\r\n      Accept: 'application/json',\r\n      'Content-Type': 'application/json'\r\n    },\r\n    body: JSON.stringify({ email: payload.email, code: payload.code })\r\n  });\r\n\r\n  if (!response.ok) {\r\n    const body = await safeReadJson(response);\r\n    throw new CoreApiError('Failed to complete recovery', response.status, body);\r\n  }\r\n\r\n  const dto = (await response.json()) as LoginDto;\r\n  return mapLogin(dto);\r\n}\r\n\r\nfunction mapLogin(dto: LoginDto): LoginResult {\r\n  return {\r\n    sessionId: dto.session_id,\r\n    agentId: dto.agent_id,\r\n    mfaRequired: dto.mfa_required,\r\n    expiresAt: dto.expires_at,\r\n    sessionTimeoutSeconds: dto.session_timeout_seconds,\r\n    recoveryCodesRemaining: dto.recovery_codes_remaining\r\n  };\r\n}\r\n\r\nasync function safeReadJson(response: Response): Promise<unknown> {\r\n  try {\r\n    return await response.json();\r\n  } catch (error) {\r\n    return null;\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;AAGE;AAHF;AAAA;;AAEA,MAAM,oBACJ,6DAA6C;AAgDxC,eAAe,MAAM,OAAqB;IAC/C,MAAM,MAAM,IAAI,IAAI,eAAe;IACnC,MAAM,WAAW,MAAM,MAAM,KAAK;QAChC,QAAQ;QACR,SAAS;YACP,QAAQ;YACR,gBAAgB;QAClB;QACA,MAAM,KAAK,SAAS,CAAC;IACvB;IAEA,IAAI,CAAC,SAAS,EAAE,EAAE;QAChB,MAAM,OAAO,MAAM,aAAa;QAChC,MAAM,IAAI,yLAAY,CAAC,0BAA0B,SAAS,MAAM,EAAE;IACpE;IAEA,MAAM,MAAO,MAAM,SAAS,IAAI;IAChC,OAAO,SAAS;AAClB;AAEO,eAAe,UAAU,OAA+B;IAC7D,MAAM,MAAM,IAAI,IAAI,oBAAoB;IACxC,MAAM,WAAW,MAAM,MAAM,KAAK;QAChC,QAAQ;QACR,SAAS;YACP,QAAQ;YACR,gBAAgB;QAClB;QACA,MAAM,KAAK,SAAS,CAAC;YACnB,YAAY,QAAQ,SAAS;YAC7B,MAAM,QAAQ,IAAI;YAClB,QAAQ,QAAQ,MAAM,IAAI;QAC5B;IACF;IAEA,IAAI,CAAC,SAAS,EAAE,EAAE;QAChB,MAAM,OAAO,MAAM,aAAa;QAChC,MAAM,IAAI,yLAAY,CAAC,wBAAwB,SAAS,MAAM,EAAE;IAClE;IAEA,MAAM,MAAO,MAAM,SAAS,IAAI;IAChC,OAAO,SAAS;AAClB;AAEO,eAAe,iBAAiB,KAAa;IAClD,MAAM,MAAM,IAAI,IAAI,2BAA2B;IAC/C,MAAM,WAAW,MAAM,MAAM,KAAK;QAChC,QAAQ;QACR,SAAS;YACP,QAAQ;YACR,gBAAgB;QAClB;QACA,MAAM,KAAK,SAAS,CAAC;YAAE;QAAM;IAC/B;IAEA,IAAI,CAAC,SAAS,EAAE,EAAE;QAChB,MAAM,OAAO,MAAM,aAAa;QAChC,MAAM,IAAI,yLAAY,CAAC,+BAA+B,SAAS,MAAM,EAAE;IACzE;IAEA,MAAM,MAAO,MAAM,SAAS,IAAI;IAChC,OAAO;QACL,OAAO,IAAI,KAAK;QAChB,UAAU,IAAI,SAAS;QACvB,eAAe,IAAI,cAAc;IACnC;AACF;AAEO,eAAe,iBACpB,OAAkC;IAElC,MAAM,MAAM,IAAI,IAAI,2BAA2B;IAC/C,MAAM,WAAW,MAAM,MAAM,KAAK;QAChC,QAAQ;QACR,SAAS;YACP,QAAQ;YACR,gBAAgB;QAClB;QACA,MAAM,KAAK,SAAS,CAAC;YAAE,OAAO,QAAQ,KAAK;YAAE,MAAM,QAAQ,IAAI;QAAC;IAClE;IAEA,IAAI,CAAC,SAAS,EAAE,EAAE;QAChB,MAAM,OAAO,MAAM,aAAa;QAChC,MAAM,IAAI,yLAAY,CAAC,+BAA+B,SAAS,MAAM,EAAE;IACzE;IAEA,MAAM,MAAO,MAAM,SAAS,IAAI;IAChC,OAAO,SAAS;AAClB;AAEA,SAAS,SAAS,GAAa;IAC7B,OAAO;QACL,WAAW,IAAI,UAAU;QACzB,SAAS,IAAI,QAAQ;QACrB,aAAa,IAAI,YAAY;QAC7B,WAAW,IAAI,UAAU;QACzB,uBAAuB,IAAI,uBAAuB;QAClD,wBAAwB,IAAI,wBAAwB;IACtD;AACF;AAEA,eAAe,aAAa,QAAkB;IAC5C,IAAI;QACF,OAAO,MAAM,SAAS,IAAI;IAC5B,EAAE,OAAO,OAAO;QACd,OAAO;IACT;AACF","debugId":null}},
    {"offset": {"line": 198, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/jdc/Desktop/Bmad-Method/apps/web/app/%28auth%29/login/page.tsx"],"sourcesContent":["'use client';\r\n\r\nimport Link from 'next/link';\r\nimport { useRouter } from 'next/navigation';\r\nimport { FormEvent, useState } from 'react';\r\n\r\nimport { Card } from '@/components/ui/Card';\r\nimport { CoreApiError } from '@/services/api/housekeeping';\r\nimport { login, LoginResult } from '@/services/api/auth';\r\nimport { useTranslation } from '@/lib/i18n';\r\n\r\nexport default function LoginPage() {\r\n  const router = useRouter();\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [result, setResult] = useState<LoginResult | null>(null);\r\n  const { t } = useTranslation('auth.login');\r\n\r\n  async function handleSubmit(event: FormEvent<HTMLFormElement>) {\r\n    event.preventDefault();\r\n    const form = new FormData(event.currentTarget);\r\n    const email = String(form.get('email') ?? '').trim();\r\n    const password = String(form.get('password') ?? '');\r\n\r\n    if (!email || !password) {\r\n      setError(t('errors.missingCredentials'));\r\n      return;\r\n    }\r\n\r\n    setIsSubmitting(true);\r\n    setError(null);\r\n\r\n    try {\r\n      const response = await login({ email, password });\r\n      setResult(response);\r\n      if (response.mfaRequired) {\r\n        router.push(`/mfa?sessionId=${encodeURIComponent(response.sessionId)}`);\r\n      }\r\n    } catch (apiError) {\r\n      if (apiError instanceof CoreApiError) {\r\n        const detail = (apiError.body as Record<string, any>)?.detail;\r\n        if (typeof detail === 'string') {\r\n          setError(detail);\r\n        } else if (detail && typeof detail === 'object' && 'message' in detail) {\r\n          setError(String(detail.message));\r\n        } else {\r\n          setError(t('errors.coreFailure'));\r\n        }\r\n      } else {\r\n        setError(t('errors.unexpected'));\r\n      }\r\n      setResult(null);\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  }\r\n\r\n  return (\r\n    <Card title={t('cardTitle')} description={t('cardDescription')}>\r\n      <form onSubmit={handleSubmit} className=\"auth-form\" noValidate>\r\n        <label className=\"field\">\r\n          <span>{t('labels.email')}</span>\r\n          <input type=\"email\" name=\"email\" autoComplete=\"username\" required />\r\n        </label>\r\n        <label className=\"field\">\r\n          <span>{t('labels.password')}</span>\r\n          <input type=\"password\" name=\"password\" autoComplete=\"current-password\" required />\r\n        </label>\r\n        {error && (\r\n          <p role=\"alert\" className=\"feedback error\">\r\n            {error}\r\n          </p>\r\n        )}\r\n        {result && !result.mfaRequired && (\r\n          <p className=\"feedback success\">\r\n            {t('success.sessionStarted', {\r\n              agentId: result.agentId,\r\n              minutes: Math.round(result.sessionTimeoutSeconds / 60)\r\n            })}\r\n          </p>\r\n        )}\r\n        <button type=\"submit\" className=\"primary\" disabled={isSubmitting}>\r\n          {isSubmitting ? t('actions.submitting') : t('actions.submit')}\r\n        </button>\r\n        <p className=\"aux\">\r\n          {t('links.recoverPrompt')}{' '}\r\n          <Link href=\"/recover\">{t('links.recoverCta')}</Link>\r\n        </p>\r\n      </form>\r\n      <style jsx>{`\r\n        .auth-form {\r\n          display: grid;\r\n          gap: var(--space-4);\r\n        }\r\n        .field {\r\n          display: grid;\r\n          gap: var(--space-2);\r\n        }\r\n        input {\r\n          border: 1px solid var(--color-neutral-5);\r\n          border-radius: var(--radius-sm);\r\n          padding: var(--space-2) var(--space-3);\r\n          font-size: 1rem;\r\n        }\r\n        .primary {\r\n          background: var(--color-deep-blue);\r\n          color: #fff;\r\n          border: none;\r\n          padding: var(--space-3);\r\n          border-radius: var(--radius-sm);\r\n          font-weight: 600;\r\n          cursor: pointer;\r\n        }\r\n        .primary:disabled {\r\n          opacity: 0.6;\r\n          cursor: not-allowed;\r\n        }\r\n        .feedback {\r\n          margin: 0;\r\n          font-size: 0.95rem;\r\n        }\r\n        .feedback.error {\r\n          color: #b00020;\r\n        }\r\n        .feedback.success {\r\n          color: var(--color-success, #0f7b6c);\r\n        }\r\n        .aux {\r\n          margin: 0;\r\n          font-size: 0.9rem;\r\n          color: var(--color-neutral-9);\r\n        }\r\n        .aux a {\r\n          color: var(--color-deep-blue);\r\n          font-weight: 600;\r\n        }\r\n      `}</style>\r\n    </Card>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;;AAEA;AACA;AACA;AAEA;AACA;AAAA;AACA;AACA;AAAA;;;AATA;;;;;;;;;AAWe,SAAS;;IACtB,MAAM,SAAS,IAAA,+KAAS;IACxB,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,sMAAQ,EAAC;IACjD,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,sMAAQ,EAAgB;IAClD,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,sMAAQ,EAAqB;IACzD,MAAM,EAAE,CAAC,EAAE,GAAG,IAAA,8LAAc,EAAC;IAE7B,eAAe,aAAa,KAAiC;QAC3D,MAAM,cAAc;QACpB,MAAM,OAAO,IAAI,SAAS,MAAM,aAAa;QAC7C,MAAM,QAAQ,OAAO,KAAK,GAAG,CAAC,YAAY,IAAI,IAAI;QAClD,MAAM,WAAW,OAAO,KAAK,GAAG,CAAC,eAAe;QAEhD,IAAI,CAAC,SAAS,CAAC,UAAU;YACvB,SAAS,EAAE;YACX;QACF;QAEA,gBAAgB;QAChB,SAAS;QAET,IAAI;YACF,MAAM,WAAW,MAAM,IAAA,+KAAK,EAAC;gBAAE;gBAAO;YAAS;YAC/C,UAAU;YACV,IAAI,SAAS,WAAW,EAAE;gBACxB,OAAO,IAAI,CAAC,CAAC,eAAe,EAAE,mBAAmB,SAAS,SAAS,GAAG;YACxE;QACF,EAAE,OAAO,UAAU;YACjB,IAAI,oBAAoB,yLAAY,EAAE;gBACpC,MAAM,SAAU,SAAS,IAAI,EAA0B;gBACvD,IAAI,OAAO,WAAW,UAAU;oBAC9B,SAAS;gBACX,OAAO,IAAI,UAAU,OAAO,WAAW,YAAY,aAAa,QAAQ;oBACtE,SAAS,OAAO,OAAO,OAAO;gBAChC,OAAO;oBACL,SAAS,EAAE;gBACb;YACF,OAAO;gBACL,SAAS,EAAE;YACb;YACA,UAAU;QACZ,SAAU;YACR,gBAAgB;QAClB;IACF;IAEA,qBACE,0NAAC,gLAAI;QAAC,OAAO,EAAE;QAAc,aAAa,EAAE;;0BAC1C,0NAAC;gBAAK,UAAU;gBAAoC,UAAU;0DAAtB;;kCACtC,0NAAC;kEAAgB;;0CACf,0NAAC;;0CAAM,EAAE;;;;;;0CACT,0NAAC;gCAAM,MAAK;gCAAQ,MAAK;gCAAQ,cAAa;gCAAW,QAAQ;;;;;;;;;;;;;kCAEnE,0NAAC;kEAAgB;;0CACf,0NAAC;;0CAAM,EAAE;;;;;;0CACT,0NAAC;gCAAM,MAAK;gCAAW,MAAK;gCAAW,cAAa;gCAAmB,QAAQ;;;;;;;;;;;;;oBAEhF,uBACC,0NAAC;wBAAE,MAAK;kEAAkB;kCACvB;;;;;;oBAGJ,UAAU,CAAC,OAAO,WAAW,kBAC5B,0NAAC;kEAAY;kCACV,EAAE,0BAA0B;4BAC3B,SAAS,OAAO,OAAO;4BACvB,SAAS,KAAK,KAAK,CAAC,OAAO,qBAAqB,GAAG;wBACrD;;;;;;kCAGJ,0NAAC;wBAAO,MAAK;wBAA6B,UAAU;kEAApB;kCAC7B,eAAe,EAAE,wBAAwB,EAAE;;;;;;kCAE9C,0NAAC;kEAAY;;4BACV,EAAE;4BAAwB;0CAC3B,0NAAC,uMAAI;gCAAC,MAAK;0CAAY,EAAE;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqDnC;GAhIwB;;QACP,+KAAS;QAIV,8LAAc;;;KALN","debugId":null}}]
}