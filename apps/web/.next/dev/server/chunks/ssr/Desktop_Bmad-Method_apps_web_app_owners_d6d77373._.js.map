{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/jdc/Desktop/Bmad-Method/apps/web/app/owners/OwnerAccessContext.tsx"],"sourcesContent":["'use client';\r\n\r\nimport {\r\n  createContext,\r\n  useCallback,\r\n  useContext,\r\n  useEffect,\r\n  useMemo,\r\n  useState\r\n} from 'react';\r\n\r\nconst STORAGE_KEY = 'bmad-owner-token';\r\nconst DEFAULT_OWNER_ID = Number(process.env.NEXT_PUBLIC_OWNER_ID ?? '1');\r\nconst EXPECTED_TOKEN = process.env.NEXT_PUBLIC_OWNER_TOKEN ?? 'demo-owner-token';\r\n\r\ntype OwnerAccessStatus = 'checking' | 'authenticated' | 'unauthenticated';\r\n\r\ntype OwnerAccessContextValue = {\r\n  ownerId: number;\r\n  token: string | null;\r\n  status: OwnerAccessStatus;\r\n  authenticate: (code: string) => boolean;\r\n  logout: () => void;\r\n};\r\n\r\nconst OwnerAccessContext = createContext<OwnerAccessContextValue | undefined>(undefined);\r\n\r\nexport function OwnerAccessProvider({ children }: { children: React.ReactNode }) {\r\n  const [token, setToken] = useState<string | null>(null);\r\n  const [status, setStatus] = useState<OwnerAccessStatus>('checking');\r\n\r\n  useEffect(() => {\r\n    if (typeof window === 'undefined') {\r\n      return;\r\n    }\r\n    const stored = window.sessionStorage.getItem(STORAGE_KEY);\r\n    if (stored) {\r\n      setToken(stored);\r\n      setStatus('authenticated');\r\n    } else {\r\n      setStatus('unauthenticated');\r\n    }\r\n  }, []);\r\n\r\n  const authenticate = useCallback((code: string) => {\r\n    if (code.trim() === EXPECTED_TOKEN) {\r\n      if (typeof window !== 'undefined') {\r\n        window.sessionStorage.setItem(STORAGE_KEY, code.trim());\r\n      }\r\n      setToken(code.trim());\r\n      setStatus('authenticated');\r\n      return true;\r\n    }\r\n    setStatus('unauthenticated');\r\n    return false;\r\n  }, []);\r\n\r\n  const logout = useCallback(() => {\r\n    if (typeof window !== 'undefined') {\r\n      window.sessionStorage.removeItem(STORAGE_KEY);\r\n    }\r\n    setToken(null);\r\n    setStatus('unauthenticated');\r\n  }, []);\r\n\r\n  const value = useMemo(\r\n    () => ({ ownerId: DEFAULT_OWNER_ID, token, status, authenticate, logout }),\r\n    [token, status, authenticate, logout]\r\n  );\r\n\r\n  return <OwnerAccessContext.Provider value={value}>{children}</OwnerAccessContext.Provider>;\r\n}\r\n\r\nexport function useOwnerAccess(): OwnerAccessContextValue {\r\n  const context = useContext(OwnerAccessContext);\r\n  if (!context) {\r\n    throw new Error('useOwnerAccess must be used within OwnerAccessProvider');\r\n  }\r\n  return context;\r\n}\r\n"],"names":[],"mappings":";;;;;;;AAEA;AAFA;;;AAWA,MAAM,cAAc;AACpB,MAAM,mBAAmB,OAAO,QAAQ,GAAG,CAAC,oBAAoB,IAAI;AACpE,MAAM,iBAAiB,QAAQ,GAAG,CAAC,uBAAuB,IAAI;AAY9D,MAAM,mCAAqB,IAAA,mPAAa,EAAsC;AAEvE,SAAS,oBAAoB,EAAE,QAAQ,EAAiC;IAC7E,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,8OAAQ,EAAgB;IAClD,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,8OAAQ,EAAoB;IAExD,IAAA,+OAAS,EAAC;QACR,wCAAmC;YACjC;QACF;;;QACA,MAAM;IAOR,GAAG,EAAE;IAEL,MAAM,eAAe,IAAA,iPAAW,EAAC,CAAC;QAChC,IAAI,KAAK,IAAI,OAAO,gBAAgB;YAClC;;YAGA,SAAS,KAAK,IAAI;YAClB,UAAU;YACV,OAAO;QACT;QACA,UAAU;QACV,OAAO;IACT,GAAG,EAAE;IAEL,MAAM,SAAS,IAAA,iPAAW,EAAC;QACzB;;QAGA,SAAS;QACT,UAAU;IACZ,GAAG,EAAE;IAEL,MAAM,QAAQ,IAAA,6OAAO,EACnB,IAAM,CAAC;YAAE,SAAS;YAAkB;YAAO;YAAQ;YAAc;QAAO,CAAC,GACzE;QAAC;QAAO;QAAQ;QAAc;KAAO;IAGvC,qBAAO,2QAAC,mBAAmB,QAAQ;QAAC,OAAO;kBAAQ;;;;;;AACrD;AAEO,SAAS;IACd,MAAM,UAAU,IAAA,gPAAU,EAAC;IAC3B,IAAI,CAAC,SAAS;QACZ,MAAM,IAAI,MAAM;IAClB;IACA,OAAO;AACT","debugId":null}},
    {"offset": {"line": 79, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/jdc/Desktop/Bmad-Method/apps/web/app/owners/layout.tsx"],"sourcesContent":["'use client';\r\n\r\nimport Link from 'next/link';\r\nimport { usePathname } from 'next/navigation';\r\nimport { FormEvent, useMemo, useState } from 'react';\r\nimport { OwnerAccessProvider, useOwnerAccess } from './OwnerAccessContext';\r\n\r\nconst NAV_ITEMS = [\r\n  { href: '/owners', label: 'Overview' },\r\n  { href: '/owners/propriedades', label: 'Propriedades' },\r\n  { href: '/owners/faturas', label: 'Faturas' },\r\n  { href: '/owners/relatorios', label: 'Relatórios' }\r\n] as const;\r\n\r\nexport default function OwnersLayout({ children }: { children: React.ReactNode }) {\r\n  return (\r\n    <OwnerAccessProvider>\r\n      <OwnersGuard>{children}</OwnersGuard>\r\n    </OwnerAccessProvider>\r\n  );\r\n}\r\n\r\nfunction OwnersGuard({ children }: { children: React.ReactNode }) {\r\n  const { status, authenticate, logout, ownerId } = useOwnerAccess();\r\n  const [code, setCode] = useState('');\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  if (status === 'checking') {\r\n    return (\r\n      <div className=\"owners-gate\" role=\"status\">\r\n        <p>Validando sessão segura do proprietário…</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const handleSubmit = (event: FormEvent<HTMLFormElement>) => {\r\n    event.preventDefault();\r\n    const success = authenticate(code);\r\n    if (!success) {\r\n      setError('Código inválido. Confirme as credenciais enviadas pelo gestor de operações.');\r\n    } else {\r\n      setError(null);\r\n    }\r\n  };\r\n\r\n  if (status !== 'authenticated') {\r\n    return (\r\n      <div className=\"owners-gate\">\r\n        <section className=\"owners-card\">\r\n          <h1>Portal do Proprietário</h1>\r\n          <p>Introduza o código de acesso fornecido pela equipa Bmad Method.</p>\r\n          <form onSubmit={handleSubmit} className=\"owners-form\">\r\n            <label htmlFor=\"owner-code\">Código de acesso</label>\r\n            <input\r\n              id=\"owner-code\"\r\n              name=\"owner-code\"\r\n              type=\"password\"\r\n              autoComplete=\"one-time-code\"\r\n              value={code}\r\n              onChange={(event) => setCode(event.target.value)}\r\n              data-testid=\"owner-access-code\"\r\n            />\r\n            {error && <p className=\"owners-error\">{error}</p>}\r\n            <button type=\"submit\">Entrar</button>\r\n          </form>\r\n        </section>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return <OwnersShell ownerId={ownerId} logout={logout}>{children}</OwnersShell>;\r\n}\r\n\r\nfunction OwnersShell({\r\n  children,\r\n  ownerId,\r\n  logout\r\n}: {\r\n  children: React.ReactNode;\r\n  ownerId: number;\r\n  logout: () => void;\r\n}) {\r\n  const pathname = usePathname();\r\n  const navItems = useMemo(\r\n    () =>\r\n      NAV_ITEMS.map((item) => ({\r\n        ...item,\r\n        active: pathname === item.href || pathname.startsWith(`${item.href}/`)\r\n      })),\r\n    [pathname]\r\n  );\r\n\r\n  return (\r\n    <div className=\"owners-shell\">\r\n      <header className=\"owners-header\">\r\n        <div>\r\n          <p className=\"owners-subtitle\">Área reservada · Proprietário #{ownerId}</p>\r\n          <h1>Painel de resultados e documentação</h1>\r\n          <p>\r\n            Acompanhe receita consolidada, métricas operacionais e atualize informações críticas com\r\n            proteção reforçada.\r\n          </p>\r\n        </div>\r\n        <button type=\"button\" className=\"owners-logout\" onClick={logout}>\r\n          Terminar sessão\r\n        </button>\r\n      </header>\r\n      <nav aria-label=\"Secções do portal\" className=\"owners-nav\">\r\n        {navItems.map((item) => (\r\n          <Link key={item.href} href={item.href} aria-current={item.active ? 'page' : undefined}>\r\n            {item.label}\r\n          </Link>\r\n        ))}\r\n      </nav>\r\n      <main className=\"owners-content\" data-testid=\"owner-content\">\r\n        {children}\r\n      </main>\r\n      <style jsx>{`\r\n        .owners-gate {\r\n          min-height: 70vh;\r\n          display: grid;\r\n          place-items: center;\r\n          padding: var(--space-6);\r\n        }\r\n        .owners-card {\r\n          background: var(--color-neutral-0);\r\n          border-radius: var(--radius-lg);\r\n          padding: var(--space-6);\r\n          max-width: 420px;\r\n          display: grid;\r\n          gap: var(--space-4);\r\n          box-shadow: var(--shadow-card);\r\n        }\r\n        .owners-form {\r\n          display: grid;\r\n          gap: var(--space-3);\r\n        }\r\n        input {\r\n          border: 1px solid rgba(37, 99, 235, 0.2);\r\n          border-radius: var(--radius-sm);\r\n          padding: var(--space-3) var(--space-4);\r\n          font-size: 1rem;\r\n        }\r\n        button {\r\n          border: none;\r\n          border-radius: var(--radius-sm);\r\n          padding: var(--space-3) var(--space-4);\r\n          background: var(--color-deep-blue);\r\n          color: #fff;\r\n          font-weight: 600;\r\n          cursor: pointer;\r\n        }\r\n        .owners-error {\r\n          color: var(--color-coral);\r\n          margin: 0;\r\n        }\r\n        .owners-shell {\r\n          display: grid;\r\n          gap: var(--space-5);\r\n        }\r\n        .owners-header {\r\n          display: flex;\r\n          justify-content: space-between;\r\n          align-items: flex-start;\r\n          gap: var(--space-5);\r\n          background: linear-gradient(135deg, rgba(37, 99, 235, 0.95), rgba(14, 165, 233, 0.85));\r\n          color: #fff;\r\n          padding: var(--space-5);\r\n          border-radius: var(--radius-lg);\r\n          box-shadow: var(--shadow-card);\r\n        }\r\n        .owners-subtitle {\r\n          margin: 0 0 var(--space-2) 0;\r\n          letter-spacing: 0.08em;\r\n          text-transform: uppercase;\r\n          font-weight: 600;\r\n        }\r\n        .owners-logout {\r\n          align-self: flex-start;\r\n          background: var(--tint-neutral-soft);\r\n        }\r\n        .owners-nav {\r\n          display: flex;\r\n          flex-wrap: wrap;\r\n          gap: var(--space-3);\r\n          background: var(--color-neutral-0);\r\n          padding: var(--space-3) var(--space-4);\r\n          border-radius: var(--radius-md);\r\n          box-shadow: var(--shadow-card);\r\n        }\r\n        .owners-nav a {\r\n          padding: var(--space-2) var(--space-4);\r\n          border-radius: var(--radius-sm);\r\n          font-weight: 500;\r\n          color: var(--color-deep-blue);\r\n          background: var(--tint-primary-soft);\r\n        }\r\n        .owners-nav a[aria-current='page'] {\r\n          background: var(--color-deep-blue);\r\n          color: #fff;\r\n        }\r\n        .owners-content {\r\n          display: grid;\r\n          gap: var(--space-5);\r\n        }\r\n        @media (max-width: 960px) {\r\n          .owners-header {\r\n            flex-direction: column;\r\n            align-items: flex-start;\r\n          }\r\n          .owners-nav {\r\n            flex-direction: column;\r\n          }\r\n        }\r\n        @media (max-width: 640px) {\r\n          .owners-card {\r\n            padding: var(--space-5);\r\n          }\r\n          .owners-header {\r\n            padding: var(--space-4);\r\n          }\r\n          .owners-nav {\r\n            padding: var(--space-3);\r\n          }\r\n        }\r\n      `}</style>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;;AAEA;AACA;AACA;AACA;AALA;;;;;;;AAOA,MAAM,YAAY;IAChB;QAAE,MAAM;QAAW,OAAO;IAAW;IACrC;QAAE,MAAM;QAAwB,OAAO;IAAe;IACtD;QAAE,MAAM;QAAmB,OAAO;IAAU;IAC5C;QAAE,MAAM;QAAsB,OAAO;IAAa;CACnD;AAEc,SAAS,aAAa,EAAE,QAAQ,EAAiC;IAC9E,qBACE,2QAAC,uMAAmB;kBAClB,cAAA,2QAAC;sBAAa;;;;;;;;;;;AAGpB;AAEA,SAAS,YAAY,EAAE,QAAQ,EAAiC;IAC9D,MAAM,EAAE,MAAM,EAAE,YAAY,EAAE,MAAM,EAAE,OAAO,EAAE,GAAG,IAAA,kMAAc;IAChE,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,8OAAQ,EAAC;IACjC,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,8OAAQ,EAAgB;IAElD,IAAI,WAAW,YAAY;QACzB,qBACE,2QAAC;YAAI,WAAU;YAAc,MAAK;sBAChC,cAAA,2QAAC;0BAAE;;;;;;;;;;;IAGT;IAEA,MAAM,eAAe,CAAC;QACpB,MAAM,cAAc;QACpB,MAAM,UAAU,aAAa;QAC7B,IAAI,CAAC,SAAS;YACZ,SAAS;QACX,OAAO;YACL,SAAS;QACX;IACF;IAEA,IAAI,WAAW,iBAAiB;QAC9B,qBACE,2QAAC;YAAI,WAAU;sBACb,cAAA,2QAAC;gBAAQ,WAAU;;kCACjB,2QAAC;kCAAG;;;;;;kCACJ,2QAAC;kCAAE;;;;;;kCACH,2QAAC;wBAAK,UAAU;wBAAc,WAAU;;0CACtC,2QAAC;gCAAM,SAAQ;0CAAa;;;;;;0CAC5B,2QAAC;gCACC,IAAG;gCACH,MAAK;gCACL,MAAK;gCACL,cAAa;gCACb,OAAO;gCACP,UAAU,CAAC,QAAU,QAAQ,MAAM,MAAM,CAAC,KAAK;gCAC/C,eAAY;;;;;;4BAEb,uBAAS,2QAAC;gCAAE,WAAU;0CAAgB;;;;;;0CACvC,2QAAC;gCAAO,MAAK;0CAAS;;;;;;;;;;;;;;;;;;;;;;;IAKhC;IAEA,qBAAO,2QAAC;QAAY,SAAS;QAAS,QAAQ;kBAAS;;;;;;AACzD;AAEA,SAAS,YAAY,EACnB,QAAQ,EACR,OAAO,EACP,MAAM,EAKP;IACC,MAAM,WAAW,IAAA,8KAAW;IAC5B,MAAM,WAAW,IAAA,6OAAO,EACtB,IACE,UAAU,GAAG,CAAC,CAAC,OAAS,CAAC;gBACvB,GAAG,IAAI;gBACP,QAAQ,aAAa,KAAK,IAAI,IAAI,SAAS,UAAU,CAAC,GAAG,KAAK,IAAI,CAAC,CAAC,CAAC;YACvE,CAAC,IACH;QAAC;KAAS;IAGZ,qBACE,2QAAC;kDAAc;;0BACb,2QAAC;0DAAiB;;kCAChB,2QAAC;;;0CACC,2QAAC;0EAAY;;oCAAkB;oCAAgC;;;;;;;0CAC/D,2QAAC;;0CAAG;;;;;;0CACJ,2QAAC;;0CAAE;;;;;;;;;;;;kCAKL,2QAAC;wBAAO,MAAK;wBAAmC,SAAS;kEAAzB;kCAAiC;;;;;;;;;;;;0BAInE,2QAAC;gBAAI,cAAW;0DAA8B;0BAC3C,SAAS,GAAG,CAAC,CAAC,qBACb,2QAAC,oMAAI;wBAAiB,MAAM,KAAK,IAAI;wBAAE,gBAAc,KAAK,MAAM,GAAG,SAAS;kCACzE,KAAK,KAAK;uBADF,KAAK,IAAI;;;;;;;;;;0BAKxB,2QAAC;gBAAgC,eAAY;0DAA7B;0BACb;;;;;;;;;;;;;;;;AAiHT","debugId":null}}]
}